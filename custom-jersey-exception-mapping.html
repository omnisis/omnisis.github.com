<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Custom Exception Mapping in Jersey</title>
        <link rel="stylesheet" href="./theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="./">Next Instruction: Technology Musings </a></h1>
                <nav><ul>
                    <li class="active"><a href="./category/java-web.html">java, web</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="./custom-jersey-exception-mapping.html" rel="bookmark"
           title="Permalink to Custom Exception Mapping in Jersey">Custom Exception Mapping in Jersey</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-03-24T09:00:00">
                Mon 24 March 2014
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="./author/omnisis.html">omnisis</a>
        </address>
<p>In <a href="./category/java-web.html">java, web</a>. </p>

</footer><!-- /.post-info -->      <p>Sometimes you want precise control over how web application exceptions get
mapped to HTTP responses in JAX-RS applications.  This is super easy in Jersey,
all you have to do is implement a custom <strong>ExceptionMapper</strong> Provider.</p>
<div class="highlight"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">nextinstruction</span><span class="o">.</span><span class="na">exception</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.ws.rs.core.MediaType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.core.Response</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.ext.ExceptionMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.ext.Provider</span><span class="o">;</span>


 <span class="nd">@Provider</span>
 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">GlobalExceptionMapper</span> <span class="kd">implements</span> <span class="n">ExceptionMapper</span><span class="o">&lt;</span><span class="n">Exception</span><span class="o">&gt;</span> <span class="o">{</span>
     <span class="kd">private</span> <span class="n">Logger</span> <span class="n">LOG</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">GlobalExceptionMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

     <span class="kd">public</span> <span class="nf">GlobalExceptionMapper</span><span class="o">()</span> <span class="o">{</span>
         <span class="n">LOG</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;GlobalExceptionMapper wired up&quot;</span><span class="o">);</span>
     <span class="o">}</span>

     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="n">Response</span> <span class="nf">toResponse</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
         <span class="k">return</span> <span class="n">Response</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">Response</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">)</span>
                 <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">TEXT_PLAIN_TYPE</span><span class="o">)</span>
                 <span class="o">.</span><span class="na">entity</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()).</span><span class="na">build</span><span class="o">();</span>
     <span class="o">}</span>
 <span class="o">}</span>
</pre></div>


<p>The above will catch <em>ANY</em> exception thrown from your resources but what if you
want to format a specific exception differently?  You can do that to with
another mapper.</p>
<div class="highlight"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">nextinstruction</span><span class="o">.</span><span class="na">exception</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppException</span> <span class="kd">extends</span> <span class="n">Exception</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>


    <span class="kd">public</span> <span class="nf">AppException</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">AppException</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">,</span> <span class="n">Throwable</span> <span class="n">throwable</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">throwable</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>

<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">nextinstruction</span><span class="o">.</span><span class="na">exception</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.ws.rs.core.MediaType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.core.Response</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.ext.ExceptionMapper</span><span class="o">;</span>

<span class="nd">@Provider</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppExceptionMapper</span> <span class="kd">implements</span> <span class="n">ExceptionMapper</span><span class="o">&lt;</span><span class="n">AppException</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Response</span> <span class="nf">toResponse</span><span class="o">(</span><span class="n">AppException</span> <span class="n">exception</span><span class="o">)</span> <span class="o">{</span>
         <span class="k">return</span> <span class="n">Response</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">Response</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">TEXT_PLAIN_TYPE</span><span class="o">)</span>
                <span class="o">.</span><span class="na">entity</span><span class="o">(</span><span class="n">exception</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;\nWhat were you thinking?&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>And here is an example that will excercise our excpetions:</p>
<div class="highlight"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">nextinstruction</span><span class="o">.</span><span class="na">resources</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.nextinstruction.exception.AppException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.ws.rs.GET</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.Path</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.PathParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.Produces</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.core.MediaType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.ParseException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/epochtime&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnixTimestampResource</span> <span class="o">{</span>



    <span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;{year}/{month}/{day}&quot;</span><span class="o">)</span>
    <span class="nd">@GET</span>
    <span class="nd">@Produces</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">toEpochTime</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">&quot;year&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">year</span><span class="o">,</span>
                            <span class="nd">@PathParam</span><span class="o">(</span><span class="s">&quot;month&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">month</span><span class="o">,</span>
                            <span class="nd">@PathParam</span><span class="o">(</span><span class="s">&quot;day&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">day</span><span class="o">)</span> <span class="o">{</span>

        <span class="kd">final</span> <span class="n">String</span> <span class="n">dateString</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%s%s%s&quot;</span><span class="o">,</span><span class="n">year</span><span class="o">,</span><span class="n">month</span><span class="o">,</span><span class="n">day</span><span class="o">);</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&quot;yyyyMMdd&quot;</span><span class="o">).</span><span class="na">parse</span><span class="o">(</span><span class="n">dateString</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">date</span><span class="o">.</span><span class="na">getTime</span><span class="o">()/</span><span class="mi">1000</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">ParseException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">AppException</span><span class="o">(</span><span class="s">&quot;Invalid Date Params: y=&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s">&quot;,m=&quot;</span><span class="o">+</span><span class="n">month</span><span class="o">+</span><span class="s">&quot;,d=&quot;</span><span class="o">+</span><span class="n">day</span><span class="o">,</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>And here's what we get back:</p>
<div class="highlight"><pre>curl -v http://localhost:7878/epochtime/2001/01/abc
* About to connect() to localhost port 7878 (#0)
*   Trying ::1...
* connected
* Connected to localhost (::1) port 7878 (#0)
&gt; GET /epochtime/2001/01/abc HTTP/1.1
&gt; User-Agent: curl/7.24.0 (x86_64-apple-darwin12.0) libcurl/7.24.0 OpenSSL/0.9.8y zlib/1.2.5
&gt; Host: localhost:7878
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 400 Bad Request
&lt; Set-Cookie: JSESSIONID=uiwc5zr2wcvv1vuojfnlut3y2;Path=/
&lt; Expires: Thu, 01 Jan 1970 00:00:00 GMT
&lt; Content-Length: 62
&lt; Content-Type: text/plain
&lt; Server: Jetty(8.1.14.v20131031)
Invalid Date Params: y=2001,m=01,d=abc
What were you thinking?* Closing connection #0
</pre></div>
    </div><!-- /.entry-content -->
    <div class="comments">
      <h2>Comments !</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_identifier = "custom-jersey-exception-mapping.html";
        var disqus_url = "./custom-jersey-exception-mapping.html";
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://nextinstruction.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
    </div>

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'nextinstruction';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>